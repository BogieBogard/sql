<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SQL: Read before you write</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">

</head>
<body>
  <div class="container">
    <header class="header">
      <div class="meme-container">
        <img src="7c6_V1.gif" alt="Shocked gorilla eating yellow bell pepper" class="meme-image" title="When you run DELETE without WHERE (1191334 rows affected)">
      </div>
              <h1><i class="fas fa-database"></i> SQL: Read before you write</h1>
      <p>A simple database tool protecting engineers from themselves</p>
      <p></p>
      
    </header>

    <div class="content-wrapper">
      <div class="main-card">
        <div class="card-header">
          <h2><i class="fas fa-code-branch"></i>Convert to SELECT Query</h2>
        </div>

        <div class="card-content">
          <div class="input-section">
            <label class="input-label" for="sqlInput">
              <i class="fas fa-edit"></i>
              Enter your UPDATE or DELETE query:
            </label>
            <div class="sql-input-container">
              <textarea 
                id="sqlInput" 
                class="sql-input"
                placeholder="UPDATE customers SET is_active = false WHERE signup_date < '2020-01-01';"
                spellcheck="false"
              ></textarea>
              <div class="input-hint">Ctrl/Cmd + Enter to convert</div>
            </div>
            
            <button class="convert-button" onclick="convertSQL()">
              <i class="fas fa-bolt"></i>
              Convert to SELECT
            </button>
          </div>

          <div class="output-section">
            <div class="output-header">
              <span class="output-label">
                <i class="fas fa-eye"></i>
                Preview Query:
              </span>
              <div id="statusIndicator" class="status-indicator"></div>
            </div>
            <div class="output-container">
              <div id="preview" class="output-content empty">Your converted SELECT query will appear here...</div>
              <button class="copy-button" onclick="copyToClipboard()" title="Copy to clipboard">
                <i class="fas fa-copy"></i>
                Copy
              </button>
            </div>
          </div>

          <div class="examples">
            <h3><i class="fas fa-lightbulb"></i>Example Queries (click to try):</h3>
            
            <div class="example" onclick="loadExample(this)">
              <div class="example-label">
                <i class="fas fa-pen"></i>
                Complex UPDATE Example:
              </div>
              <div class="example-code">UPDATE customer_orders 
SET 
    order_status = 'shipped',
    shipping_date = CURRENT_TIMESTAMP,
    tracking_number = CONCAT('TRK-', LPAD(CAST(RAND() * 1000000 AS INT), 6, '0')),
    last_modified = NOW(),
    modified_by = 'system_batch_job'
WHERE 
    order_date >= '2023-01-01' 
    AND order_date <= '2023-12-31'
    AND order_status IN ('pending', 'processing')
    AND customer_id IN (
        SELECT customer_id 
        FROM premium_customers 
        WHERE subscription_active = true
    )
    AND total_amount > 100.00
    AND shipping_address IS NOT NULL
    AND (payment_status = 'paid' OR payment_method = 'credit_card')
    AND EXISTS (
        SELECT 1 
        FROM inventory 
        WHERE product_id = customer_orders.product_id 
        AND stock_quantity > 0
    );</div>
            </div>
            
            <div class="example" onclick="loadExample(this)">
              <div class="example-label">
                <i class="fas fa-trash-alt"></i>
                Complex DELETE Example:
              </div>
              <div class="example-code">DELETE FROM user_sessions 
WHERE 
    last_activity < DATE_SUB(NOW(), INTERVAL 30 DAY)
    AND user_id NOT IN (
        SELECT user_id 
        FROM active_users 
        WHERE last_login > DATE_SUB(NOW(), INTERVAL 7 DAY)
    )
    AND session_type = 'temporary';</div>
            </div>
          </div>
        </div>
      </div>

      <div class="vision-section">
        <div class="vision-content">
          <h3><i class="fas fa-info-circle"></i> About This Tool</h3>
          <p>Running a read operation before your write operation helps prevent costly mistakes in databases. This simple tool converts UPDATE and DELETE queries into SELECT statements using regex pattern matching, allowing you to preview exactly which data will be affected before making any changes.</p>
          
          <h3><i class="fas fa-lightbulb"></i> Future Vision</h3>
          <p>Ideally, a utility like this would run by default in SQL editors.<br><br>When a user executes an UPDATE or DELETE statement, the editor would automatically run a read version of the query under the hood and count the number of records that would be affected. If that record count exceeds a configured threshold, the user would receive a warning: "This query will change X number of rows. Do you wish to continue?"<br><br>
            
Moving fast is great, but I don't like to break things, especially not production databases. And in the era of AI vibe coding, it's easy to move too fast. It'd be great to have more protection tools built into our various editors. 

<br><br>In the future, I'd like to integrate this feature into an open-source SQL editor.</p>
        </div>
      </div>
    </div>

    <footer class="footer">
      <p>
        <i class="fas fa-lock"></i>
        Entries on this page are not saved       </p>
    </footer>
  </div>

  <script src="script.js"></script>
</body>
</html>
